{"version":3,"file":"chatbot.min.js","sources":["../src/chatbot.js"],"sourcesContent":["define(['jquery', 'core/templates'], function($, Templates) {\r\n    'use strict';\r\n\r\n    const STORAGE_KEY = 'ai_chat_history';\r\n\r\n    function loadHistory() {\r\n        let history = localStorage.getItem(STORAGE_KEY);\r\n        if (!history) return;\r\n        history = JSON.parse(history);\r\n\r\n        history.forEach(msg => appendMessage(msg.text, msg.sender, false));\r\n        scrollMessagesToBottom();\r\n    }\r\n\r\n    function saveMessage(text, sender) {\r\n        let history = localStorage.getItem(STORAGE_KEY);\r\n        history = history ? JSON.parse(history) : [];\r\n        history.push({ text, sender });\r\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(history));\r\n    }\r\n\r\n    function appendMessage(text, sender, store = true) {\r\n        const className = sender === 'user' ? 'msg-user' : 'msg-bot';\r\n        $('#chatbot-messages').append(`<div class=\"message ${className}\">${text}</div>`);\r\n\r\n        if (store) saveMessage(text, sender);\r\n        scrollMessagesToBottom();\r\n    }\r\n\r\n    function scrollMessagesToBottom() {\r\n        const msgBox = $('#chatbot-messages')[0];\r\n        if (msgBox) {\r\n            msgBox.scrollTop = msgBox.scrollHeight;\r\n        }\r\n    }\r\n\r\n    function handleSend() {\r\n        const input = $('#chatbot-input');\r\n        const text = input.val().trim();\r\n        if (!text) return;\r\n\r\n        appendMessage(text, 'user');\r\n        console.log(\"User typed:\", text);\r\n        input.val('');\r\n\r\n        setTimeout(() => {\r\n            appendMessage(\"Working âœ…\", 'bot');\r\n        }, 500);\r\n    }\r\n\r\n    function bindEvents() {\r\n        $('#ai-chatbot-button').on('click', () => {\r\n            $('#ai-chatbot-modal').toggleClass('hidden');\r\n            $('#chatbot-input').focus();\r\n        });\r\n\r\n        $('#chatbot-close-btn').on('click', () => {\r\n            $('#ai-chatbot-modal').addClass('hidden');\r\n        });\r\n\r\n        $('#chatbot-send-btn').on('click', handleSend);\r\n\r\n        $('#chatbot-input').on('keypress', function(e) {\r\n            if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                handleSend();\r\n            }\r\n        });\r\n    }\r\n\r\n    function init() {\r\n        Templates.render('local_automation/chatbot', {})\r\n            .then(html => {\r\n                $('body').append(html);\r\n                bindEvents();\r\n                loadHistory();\r\n            })\r\n            .catch(err => console.error(\"Chatbot template load failed:\", err));\r\n    }\r\n\r\n    return { init: init };\r\n});\r\n"],"names":["define","$","Templates","saveMessage","text","sender","history","localStorage","getItem","JSON","parse","push","setItem","stringify","appendMessage","store","className","append","scrollMessagesToBottom","msgBox","scrollTop","scrollHeight","handleSend","input","val","trim","console","log","setTimeout","init","render","then","html","on","toggleClass","focus","addClass","e","key","preventDefault","forEach","msg","loadHistory","catch","err","error"],"mappings":"AAAAA,kCAAO,CAAC,SAAU,mBAAmB,SAASC,EAAGC,oBAcpCC,YAAYC,KAAMC,YACnBC,QAAUC,aAAaC,QAZX,mBAahBF,QAAUA,QAAUG,KAAKC,MAAMJ,SAAW,GAC1CA,QAAQK,KAAK,CAAEP,KAAAA,KAAMC,OAAAA,SACrBE,aAAaK,QAfG,kBAekBH,KAAKI,UAAUP,mBAG5CQ,cAAcV,KAAMC,YAAQU,uEAC3BC,UAAuB,SAAXX,OAAoB,WAAa,UACnDJ,EAAE,qBAAqBgB,qCAA8BD,uBAAcZ,gBAE/DW,OAAOZ,YAAYC,KAAMC,QAC7Ba,kCAGKA,+BACCC,OAASlB,EAAE,qBAAqB,GAClCkB,SACAA,OAAOC,UAAYD,OAAOE,uBAIzBC,mBACCC,MAAQtB,EAAE,kBACVG,KAAOmB,MAAMC,MAAMC,OACpBrB,OAELU,cAAcV,KAAM,QACpBsB,QAAQC,IAAI,cAAevB,MAC3BmB,MAAMC,IAAI,IAEVI,YAAW,KACPd,cAAc,YAAa,SAC5B,YAiCA,CAAEe,gBATL3B,UAAU4B,OAAO,2BAA4B,IACxCC,MAAKC,OACF/B,EAAE,QAAQgB,OAAOe,MAtBzB/B,EAAE,sBAAsBgC,GAAG,SAAS,KAChChC,EAAE,qBAAqBiC,YAAY,UACnCjC,EAAE,kBAAkBkC,WAGxBlC,EAAE,sBAAsBgC,GAAG,SAAS,KAChChC,EAAE,qBAAqBmC,SAAS,aAGpCnC,EAAE,qBAAqBgC,GAAG,QAASX,YAEnCrB,EAAE,kBAAkBgC,GAAG,YAAY,SAASI,GAC1B,UAAVA,EAAEC,MACFD,EAAEE,iBACFjB,gCA3DJhB,QAAUC,aAAaC,QAHX,mBAIXF,UACLA,QAAUG,KAAKC,MAAMJ,SAErBA,QAAQkC,SAAQC,KAAO3B,cAAc2B,IAAIrC,KAAMqC,IAAIpC,QAAQ,KAC3Da,0BAgEQwB,MAEHC,OAAMC,KAAOlB,QAAQmB,MAAM,gCAAiCD"}
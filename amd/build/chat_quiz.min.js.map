{"version":3,"file":"chat_quiz.min.js","sources":["../src/chat_quiz.js"],"sourcesContent":["// local/automation/amd/src/chat_quiz.js\r\ndefine(['jquery', 'core/notification'], function($, Notification) {\r\n    'use strict';\r\n\r\n    // --- State ---\r\n\r\n    let selectedCourseId = null;\r\n    let selectedSectionId = null;\r\n\r\n    let fileMetaById = {};    // fileid -> { name, path, sectionname, courseid }\r\n    let selectedFileIds = []; // array of selected fileids\r\n    let currentSections = []; // from fetch_files, used to populate section dropdown\r\n\r\n    let quizConfig = {\r\n        quizname: '',\r\n        numquestions: 10,\r\n        marksperquestion: 1,\r\n        timelimitminutes: 0\r\n    };\r\n\r\n    let draftQuestions = [];  // array of question objects from Groq\r\n\r\n    // --- Helpers shared with chatbot.js ---\r\n\r\n    function reset() {\r\n        selectedCourseId = null;\r\n        selectedSectionId = null;\r\n        fileMetaById = {};\r\n        selectedFileIds = [];\r\n        currentSections = [];\r\n        quizConfig = {\r\n            quizname: '',\r\n            numquestions: 10,\r\n            marksperquestion: 1,\r\n            timelimitminutes: 0\r\n        };\r\n        draftQuestions = [];\r\n\r\n        $('#quiz-panel').remove();\r\n        $('#chatbot-input').prop('disabled', false);\r\n        $('#chatbot-send-btn').prop('disabled', false).text('Send');\r\n    }\r\n\r\n    function beforeSend(text) {\r\n        // Not used by shell; chatbot.js calls generate() directly in quiz mode.\r\n        return text;\r\n    }\r\n\r\n    function handleResponse(res, ui) {\r\n        // Quiz mode doesn't use chatbot_endpoint.php responses.\r\n        return false;\r\n    }\r\n\r\n    // Escape HTML helper\r\n    function escapeHtml(str) {\r\n        if (str === null || str === undefined) return '';\r\n        return String(str)\r\n            .replace(/&/g, '&amp;')\r\n            .replace(/</g, '&lt;')\r\n            .replace(/>/g, '&gt;')\r\n            .replace(/\"/g, '&quot;')\r\n            .replace(/'/g, '&#039;');\r\n    }\r\n\r\n    // --- UI PANEL CREATION ---\r\n\r\n    function ensurePanel() {\r\n        if ($('#quiz-panel').length) {\r\n            return;\r\n        }\r\n\r\n        const html = `\r\n            <div id=\"quiz-panel\" class=\"quiz-panel\">\r\n                <div class=\"quiz-row\">\r\n                    <label>Subject (course)</label>\r\n                    <select id=\"quiz-course-select\">\r\n                        <option value=\"\">Select course.</option>\r\n                        <!-- Options loaded via AJAX -->\r\n                    </select>\r\n                </div>\r\n\r\n                <div class=\"quiz-row\">\r\n                    <label>Upload quiz to section</label>\r\n                    <select id=\"quiz-section-select\">\r\n                        <option value=\"\">Select section.</option>\r\n                        <!-- Populated after course files are loaded -->\r\n                    </select>\r\n                </div>\r\n\r\n                <div class=\"quiz-row\">\r\n                    <label>Notes / PPTs / Docs to use as context</label>\r\n                    <div>\r\n                        <label>\r\n                            <input type=\"checkbox\" id=\"quiz-use-all-resources\">\r\n                            Select all supported files (PDF/PPT/Word)\r\n                        </label>\r\n                    </div>\r\n                    <div id=\"quiz-files-tree\" class=\"quiz-files-tree\">\r\n                        <div class=\"quiz-info\">Select a course to load files.</div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div class=\"quiz-row\">\r\n                    <label>Quiz name</label>\r\n                    <input type=\"text\" id=\"quiz-name-input\" />\r\n                </div>\r\n\r\n                <div class=\"quiz-row quiz-three-cols\">\r\n                    <div>\r\n                        <label>Number of MCQs</label>\r\n                        <input type=\"number\" id=\"quiz-numquestions\" min=\"1\" value=\"10\" />\r\n                    </div>\r\n                    <div>\r\n                        <label>Marks per question</label>\r\n                        <input type=\"number\" id=\"quiz-marks\" min=\"0\" step=\"0.5\" value=\"1\" />\r\n                    </div>\r\n                    <div>\r\n                        <label>Time limit (minutes, 0 = none)</label>\r\n                        <input type=\"number\" id=\"quiz-timelimit\" min=\"0\" value=\"0\" />\r\n                    </div>\r\n                </div>\r\n\r\n                <div class=\"quiz-row quiz-hint\">\r\n                    Type any extra instructions in the chat box below\r\n                    (e.g. \"mix easy/medium questions\", \"focus on trees\").\r\n                    Then click <b>Send</b> in Quiz mode to generate MCQs.\r\n                </div>\r\n\r\n                <div class=\"quiz-draft hidden\">\r\n                    <h4>Draft questions</h4>\r\n                    <div class=\"quiz-draft-list\"></div>\r\n                    <div class=\"quiz-actions\">\r\n                        <button type=\"button\" class=\"btn btn-secondary quiz-btn-upload\">\r\n                            Upload quiz to course\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n        $('#chatbot-messages').prepend(html);\r\n\r\n        applyQuizInlineStyles();\r\n        bindPanelEvents();\r\n        updateGenerateState();\r\n        loadCourses();\r\n    }\r\n\r\n    function applyQuizInlineStyles() {\r\n        // Basic inline styling so theme can't wreck it too much\r\n        const $panel = $('#quiz-panel');\r\n        $panel.css({\r\n            border: '1px solid #ddd',\r\n            borderRadius: '8px',\r\n            padding: '8px 10px',\r\n            marginBottom: '10px',\r\n            background: '#f9fafb',\r\n            fontSize: '0.85rem'\r\n        });\r\n\r\n        $panel.find('.quiz-row').css({\r\n            marginBottom: '8px'\r\n        });\r\n\r\n        $panel.find('label').css({\r\n            display: 'block',\r\n            fontWeight: '600',\r\n            marginBottom: '3px'\r\n        });\r\n\r\n        $panel.find('select, input[type=\"number\"], input[type=\"text\"], textarea').css({\r\n            width: '100%',\r\n            maxWidth: '100%',\r\n            boxSizing: 'border-box',\r\n            padding: '4px 6px',\r\n            fontSize: '0.85rem'\r\n        });\r\n\r\n        $panel.find('.quiz-three-cols').css({\r\n            display: 'grid',\r\n            gridTemplateColumns: 'repeat(3, minmax(0, 1fr))',\r\n            gap: '8px'\r\n        });\r\n\r\n        $panel.find('.quiz-files-tree').css({\r\n            maxHeight: '180px',\r\n            overflowY: 'auto',\r\n            padding: '4px 6px',\r\n            background: '#fff',\r\n            border: '1px solid #e5e7eb',\r\n            borderRadius: '4px',\r\n            fontSize: '0.8rem'\r\n        });\r\n\r\n        $panel.find('.quiz-draft').css({\r\n            marginTop: '10px',\r\n            paddingTop: '8px',\r\n            borderTop: '1px solid #ddd'\r\n        });\r\n\r\n        $panel.find('.quiz-draft-item').css({\r\n            border: '1px solid #ddd',\r\n            borderRadius: '6px',\r\n            padding: '6px',\r\n            marginBottom: '8px',\r\n            background: '#ffffff'\r\n        });\r\n\r\n        $panel.find('.quiz-draft-question textarea, .quiz-draft-feedback textarea').css({\r\n            width: '100%',\r\n            boxSizing: 'border-box',\r\n            fontSize: '0.8rem'\r\n        });\r\n\r\n        $panel.find('.quiz-draft-option input[type=\"text\"]').css({\r\n            width: '80%',\r\n            marginLeft: '4px',\r\n            fontSize: '0.8rem'\r\n        });\r\n\r\n        $panel.find('.quiz-hint').css({\r\n            fontSize: '0.75rem',\r\n            color: '#555'\r\n        });\r\n    }\r\n\r\n    // --- GENERATE BUTTON ENABLE/DISABLE ---\r\n\r\n    function updateGenerateState() {\r\n        const courseVal = $('#quiz-course-select').val();\r\n        selectedCourseId = courseVal ? parseInt(courseVal, 10) : null;\r\n\r\n        const sectionVal = $('#quiz-section-select').val();\r\n        selectedSectionId = sectionVal ? parseInt(sectionVal, 10) : null;\r\n\r\n        quizConfig.quizname = $('#quiz-name-input').val().trim();\r\n        quizConfig.numquestions = parseInt($('#quiz-numquestions').val() || '0', 10);\r\n        quizConfig.marksperquestion = parseFloat($('#quiz-marks').val() || '1');\r\n        quizConfig.timelimitminutes = parseInt($('#quiz-timelimit').val() || '0', 10);\r\n\r\n        const hasCourse = !!selectedCourseId;\r\n        const hasSection = !!selectedSectionId;\r\n        const hasFiles = selectedFileIds.length > 0;\r\n        const hasQuizName = quizConfig.quizname.length > 0;\r\n        const hasNumQuestions = quizConfig.numquestions > 0;\r\n\r\n        const enabled = hasCourse && hasSection && hasFiles && hasQuizName && hasNumQuestions;\r\n\r\n        // These control Send + Generate-panel button\r\n        $('#chatbot-input').prop('disabled', !enabled);\r\n        $('#chatbot-send-btn').prop('disabled', !enabled);\r\n        // $('.quiz-btn-generate-panel').prop('disabled', !enabled);\r\n    }\r\n\r\n    // --- AJAX: COURSES & FILES (reuse qb_ajax.php) ---\r\n\r\n    function loadCourses() {\r\n        $.ajax({\r\n            url: M.cfg.wwwroot + '/local/automation/qb_ajax.php',\r\n            method: 'POST',\r\n            data: JSON.stringify({\r\n                action: 'fetch_courses',\r\n                sesskey: M.cfg.sesskey\r\n            }),\r\n            contentType: 'application/json',\r\n            dataType: 'json',\r\n            success: function(res) {\r\n                if (!res || !res.success) {\r\n                    console.error('Quiz fetch_courses error:', res);\r\n                    return;\r\n                }\r\n                populateCourseSelect(res.courses || []);\r\n            },\r\n            error: function(xhr) {\r\n                console.error('Quiz fetch_courses AJAX error:', xhr);\r\n            }\r\n        });\r\n    }\r\n\r\n    function populateCourseSelect(courses) {\r\n        const $select = $('#quiz-course-select');\r\n        $select.empty();\r\n        $select.append('<option value=\"\">Select course.</option>');\r\n\r\n        courses.forEach(c => {\r\n            const label = escapeHtml(c.fullname || c.shortname || ('Course ' + c.id));\r\n            $select.append(\r\n                `<option value=\"${String(c.id)}\">${label}</option>`\r\n            );\r\n        });\r\n    }\r\n\r\n    function loadFilesForCourse(courseid) {\r\n        if (!courseid) {\r\n            $('#quiz-files-tree').html('<div class=\"quiz-info\">Select a course to load files.</div>');\r\n            $('#quiz-section-select').empty().append('<option value=\"\">Select section.</option>');\r\n            fileMetaById = {};\r\n            selectedFileIds = [];\r\n            currentSections = [];\r\n            $('#quiz-use-all-resources').prop('checked', false);\r\n            updateGenerateState();\r\n            return;\r\n        }\r\n\r\n        $.ajax({\r\n            url: M.cfg.wwwroot + '/local/automation/qb_ajax.php',\r\n            method: 'POST',\r\n            data: JSON.stringify({\r\n                action: 'fetch_files',\r\n                courseid: courseid,\r\n                sesskey: M.cfg.sesskey\r\n            }),\r\n            contentType: 'application/json',\r\n            dataType: 'json',\r\n            success: function(res) {\r\n                if (!res || !res.success) {\r\n                    console.error('Quiz fetch_files error:', res);\r\n                    $('#quiz-files-tree').html('<div class=\"quiz-info\">No files found for this course.</div>');\r\n                    fileMetaById = {};\r\n                    selectedFileIds = [];\r\n                    currentSections = [];\r\n                    $('#quiz-section-select').empty().append('<option value=\"\">Select section.</option>');\r\n                    updateGenerateState();\r\n                    return;\r\n                }\r\n                currentSections = res.sections || [];\r\n                populateSectionSelect(currentSections);\r\n                renderFileTree(currentSections);\r\n            },\r\n            error: function(xhr) {\r\n                console.error('Quiz fetch_files AJAX error:', xhr);\r\n                $('#quiz-files-tree').html('<div class=\"quiz-info\">Failed to load files.</div>');\r\n                fileMetaById = {};\r\n                selectedFileIds = [];\r\n                currentSections = [];\r\n                $('#quiz-section-select').empty().append('<option value=\"\">Select section.</option>');\r\n                updateGenerateState();\r\n            }\r\n        });\r\n    }\r\n\r\n    function populateSectionSelect(sections) {\r\n        const $select = $('#quiz-section-select');\r\n        $select.empty();\r\n        $select.append('<option value=\"\">Select section.</option>');\r\n\r\n        sections.forEach(sec => {\r\n            const label = escapeHtml(sec.name || ('Section ' + sec.id));\r\n            $select.append(\r\n                `<option value=\"${String(sec.id)}\">${label}</option>`\r\n            );\r\n        });\r\n    }\r\n\r\n    // --- TREE RENDERING (mirror QB but quiz-* IDs/classes) ---\r\n\r\n    function renderFileTree(sections) {\r\n        fileMetaById = {};\r\n        selectedFileIds = [];\r\n        $('#quiz-use-all-resources').prop('checked', false);\r\n\r\n        if (!sections.length) {\r\n            $('#quiz-files-tree').html('<div class=\"quiz-info\">No supported files (PDF/PPT/Word) found in this course.</div>');\r\n            updateGenerateState();\r\n            return;\r\n        }\r\n\r\n        let html = '';\r\n\r\n        sections.forEach(section => {\r\n            const sname = escapeHtml(section.name || 'Topic');\r\n            const files = Array.isArray(section.files) ? section.files : [];\r\n\r\n            if (!files.length) {\r\n                return;\r\n            }\r\n\r\n            const treeRoot = buildTreeFromFiles(section, files);\r\n\r\n            html += `\r\n                <div class=\"quiz-section\">\r\n                    <div class=\"quiz-section-title\">\r\n                        <span class=\"quiz-icon quiz-icon-section\">üìö</span>\r\n                        ${sname}\r\n                    </div>\r\n                    <div class=\"quiz-section-tree\">\r\n                        ${renderTreeNode(treeRoot)}\r\n                    </div>\r\n                </div>\r\n            `;\r\n        });\r\n\r\n        if (!html) {\r\n            html = '<div class=\"quiz-info\">No supported files (PDF/PPT/Word) found in this course.</div>';\r\n        }\r\n\r\n        $('#quiz-files-tree').html(html);\r\n        updateGenerateState();\r\n    }\r\n\r\n    function buildTreeFromFiles(section, files) {\r\n        const root = {\r\n            type: 'root',\r\n            name: section.name || 'Section',\r\n            children: {}\r\n        };\r\n\r\n        files.forEach(file => {\r\n            const fileid = file.fileid;\r\n            const name = file.name;\r\n            const path = file.path || name;\r\n\r\n            fileMetaById[fileid] = {\r\n                name: name,\r\n                path: path,\r\n                sectionname: section.name || '',\r\n                courseid: section.courseid || selectedCourseId\r\n            };\r\n\r\n            const parts = path.split('/').filter(Boolean);\r\n            let node = root;\r\n\r\n            for (let i = 0; i < parts.length - 1; i++) {\r\n                const folderName = parts[i];\r\n                if (!node.children[folderName]) {\r\n                    node.children[folderName] = {\r\n                        type: 'folder',\r\n                        name: folderName,\r\n                        children: {}\r\n                    };\r\n                }\r\n                node = node.children[folderName];\r\n            }\r\n\r\n            const filename = parts[parts.length - 1] || name;\r\n            node.children[filename] = {\r\n                type: 'file',\r\n                name: filename,\r\n                fileid: fileid\r\n            };\r\n        });\r\n\r\n        return root;\r\n    }\r\n\r\n    function renderTreeNode(node) {\r\n        if (!node || !node.children) {\r\n            return '';\r\n        }\r\n\r\n        const keys = Object.keys(node.children);\r\n        if (!keys.length) {\r\n            return '';\r\n        }\r\n\r\n        let html = '<div class=\"quiz-tree-level\">';\r\n\r\n        keys.forEach(key => {\r\n            const child = node.children[key];\r\n            if (child.type === 'folder') {\r\n                html += `\r\n                    <details class=\"quiz-folder\">\r\n                        <summary>\r\n                            <span class=\"quiz-icon quiz-icon-folder\">üìÅ</span>\r\n                            ${escapeHtml(child.name)}\r\n                        </summary>\r\n                        ${renderTreeNode(child)}\r\n                    </details>\r\n                `;\r\n            } else if (child.type === 'file') {\r\n                const fid = child.fileid;\r\n                const id = 'quiz-file-' + fid;\r\n                const labelText = escapeHtml(fileMetaById[fid].path || child.name);\r\n\r\n                html += `\r\n                    <div class=\"quiz-file\">\r\n                        <label for=\"${id}\">\r\n                            <input type=\"checkbox\"\r\n                                id=\"${id}\"\r\n                                class=\"quiz-file-checkbox\"\r\n                                data-fileid=\"${fid}\">\r\n                            <span class=\"quiz-icon quiz-icon-file\">üìÑ</span>\r\n                            ${labelText}\r\n                        </label>\r\n                    </div>\r\n                `;\r\n            }\r\n        });\r\n\r\n        html += '</div>';\r\n        return html;\r\n    }\r\n\r\n    function recomputeSelectedFiles() {\r\n        selectedFileIds = [];\r\n        $('.quiz-file-checkbox:checked').each(function() {\r\n            const fileid = parseInt($(this).data('fileid'), 10);\r\n            if (!isNaN(fileid)) {\r\n                selectedFileIds.push(fileid);\r\n            }\r\n        });\r\n    }\r\n\r\n    // --- BIND EVENTS ---\r\n\r\n    function bindPanelEvents() {\r\n        // Course changed -> reload files + sections\r\n        $('#quiz-course-select').on('change', function() {\r\n            const cid = $(this).val();\r\n            selectedCourseId = cid ? parseInt(cid, 10) : null;\r\n            loadFilesForCourse(selectedCourseId);\r\n            updateGenerateState();\r\n        });\r\n\r\n        // Section changed\r\n        $('#quiz-section-select').on('change', function() {\r\n            const sid = $(this).val();\r\n            selectedSectionId = sid ? parseInt(sid, 10) : null;\r\n            updateGenerateState();\r\n        });\r\n\r\n        // Select-all files\r\n        $('#quiz-use-all-resources').on('change', function() {\r\n            const checked = $(this).is(':checked');\r\n            $('.quiz-file-checkbox').prop('checked', checked);\r\n            recomputeSelectedFiles();\r\n            updateGenerateState();\r\n        });\r\n\r\n        // Individual file checkbox (delegated)\r\n        $('#chatbot-messages').on('change', '.quiz-file-checkbox', function() {\r\n            recomputeSelectedFiles();\r\n            const totalFiles = $('.quiz-file-checkbox').length;\r\n            const totalSelected = $('.quiz-file-checkbox:checked').length;\r\n            $('#quiz-use-all-resources').prop('checked', totalFiles > 0 && totalFiles === totalSelected);\r\n            updateGenerateState();\r\n        });\r\n\r\n        // Quiz basic config inputs\r\n        $('#quiz-name-input, #quiz-numquestions, #quiz-marks, #quiz-timelimit').on('input', function() {\r\n            updateGenerateState();\r\n        });\r\n\r\n        // Panel \"Generate questions\" button ‚Äì just call generate with empty instructions\r\n\r\n        // Upload button (delegated ‚Äì inside quiz-draft)\r\n        $('#quiz-panel').on('click', '.quiz-btn-upload', function() {\r\n            handleUpload();\r\n        });\r\n    }\r\n\r\n    // --- MODE ACTIVATION ---\r\n\r\n    function onModeActivated() {\r\n        ensurePanel();\r\n        $('#chatbot-send-btn').text('Send');\r\n\r\n        // Placeholder set by chatbot.js already; no need to override.\r\n        updateGenerateState();\r\n    }\r\n\r\n    // --- CORE: GENERATE & DRAFT RENDERING ---\r\n\r\n    /**\r\n     * Called from chatbot.js when user presses Send in Quiz mode.\r\n     * instructions = text from chat input.\r\n     */\r\n    function generate(instructions, ui) {\r\n        updateGenerateState();\r\n\r\n        if (!selectedCourseId) {\r\n            ui.appendMessage('‚ö†Ô∏è Please select a course first.', 'bot');\r\n            return;\r\n        }\r\n        if (!selectedSectionId) {\r\n            ui.appendMessage('‚ö†Ô∏è Please choose a section where the quiz will be created.', 'bot');\r\n            return;\r\n        }\r\n        if (!selectedFileIds.length) {\r\n            ui.appendMessage('‚ö†Ô∏è Please select at least one file to use as context.', 'bot');\r\n            return;\r\n        }\r\n        if (!quizConfig.quizname) {\r\n            ui.appendMessage('‚ö†Ô∏è Please enter a quiz name.', 'bot');\r\n            return;\r\n        }\r\n        if (quizConfig.numquestions <= 0) {\r\n            ui.appendMessage('‚ö†Ô∏è Number of MCQs must be greater than zero.', 'bot');\r\n            return;\r\n        }\r\n\r\n        // Lock inputs while generating\r\n        $('#quiz-course-select').prop('disabled', true);\r\n        $('#quiz-section-select').prop('disabled', true);\r\n        $('#quiz-use-all-resources').prop('disabled', true);\r\n        $('.quiz-file-checkbox').prop('disabled', true);\r\n        $('#quiz-name-input').prop('disabled', true);\r\n        $('#quiz-numquestions').prop('disabled', true);\r\n        $('#quiz-marks').prop('disabled', true);\r\n        $('#quiz-timelimit').prop('disabled', true);\r\n        $('#chatbot-input').prop('disabled', true);\r\n        $('#chatbot-send-btn').prop('disabled', true);\r\n        $('.quiz-btn-generate-panel').prop('disabled', true);\r\n\r\n        ui.appendMessage('‚è≥ Generating MCQ questions for this quiz‚Ä¶', 'bot');\r\n\r\n        const payload = {\r\n            action: 'generate',\r\n            courseid: selectedCourseId,\r\n            sectionid: selectedSectionId,\r\n            fileids: selectedFileIds,\r\n            quizname: quizConfig.quizname,\r\n            numquestions: quizConfig.numquestions,\r\n            marksperquestion: quizConfig.marksperquestion,\r\n            timelimitminutes: quizConfig.timelimitminutes,\r\n            instructions: instructions || ''\r\n        };\r\n\r\n        $.ajax({\r\n            url: M.cfg.wwwroot + '/local/automation/quiz_ajax.php?sesskey=' + M.cfg.sesskey,\r\n            method: 'POST',\r\n            contentType: 'application/json',\r\n            dataType: 'json',\r\n            data: JSON.stringify(payload),\r\n            success: function(res) {\r\n                if (!res || !res.success) {\r\n                    Notification.alert('Quiz generator', (res && res.message) ? res.message : 'Failed to generate questions.', 'OK');\r\n                    return;\r\n                }\r\n\r\n                draftQuestions = res.questions || [];\r\n                renderDraftQuestions();\r\n            },\r\n            error: function(xhr) {\r\n                console.error('Quiz generate AJAX error:', xhr);\r\n                Notification.alert('Quiz generator', 'AJAX error while contacting server.', 'OK');\r\n            },\r\n            complete: function() {\r\n                // Re-enable controls for editing / re-generation\r\n                $('#quiz-course-select').prop('disabled', false);\r\n                $('#quiz-section-select').prop('disabled', false);\r\n                $('#quiz-use-all-resources').prop('disabled', false);\r\n                $('.quiz-file-checkbox').prop('disabled', false);\r\n                $('#quiz-name-input').prop('disabled', false);\r\n                $('#quiz-numquestions').prop('disabled', false);\r\n                $('#quiz-marks').prop('disabled', false);\r\n                $('#quiz-timelimit').prop('disabled', false);\r\n                $('#chatbot-input').prop('disabled', false);\r\n                $('#chatbot-send-btn').prop('disabled', false);\r\n                // $('.quiz-btn-generate-panel').prop('disabled', false);\r\n            }\r\n        });\r\n    }\r\n\r\n    function renderDraftQuestions() {\r\n        const $draft = $('#quiz-panel .quiz-draft');\r\n        const $list = $draft.find('.quiz-draft-list');\r\n        $list.empty();\r\n\r\n        draftQuestions.forEach((q, index) => {\r\n            const opts = Array.isArray(q.options) ? q.options : [];\r\n            const correct = parseInt(q.correct_index, 10) || 0;\r\n            const feedback = q.feedback || '';\r\n\r\n            const htmlOptions = opts.map((opt, i) => `\r\n                <div class=\"quiz-draft-option\">\r\n                    <label>\r\n                        <input type=\"radio\"\r\n                               name=\"quiz-q${index}-correct\"\r\n                               value=\"${i}\" ${i === correct ? 'checked' : ''} />\r\n                        Correct\r\n                    </label>\r\n                    <input type=\"text\"\r\n                           class=\"quiz-q${index}-opt\"\r\n                           data-index=\"${i}\"\r\n                           value=\"${escapeHtml(opt)}\" />\r\n                </div>\r\n            `).join('');\r\n\r\n            const block = `\r\n                <div class=\"quiz-draft-item\" data-qindex=\"${index}\">\r\n                    <div class=\"quiz-draft-question\">\r\n                        <label>Question ${index + 1}</label>\r\n                        <textarea class=\"quiz-q${index}-text\" rows=\"3\">${escapeHtml(q.questiontext || '')}</textarea>\r\n                    </div>\r\n                    <div class=\"quiz-draft-options\">\r\n                        ${htmlOptions}\r\n                    </div>\r\n                    <div class=\"quiz-draft-feedback\">\r\n                        <label>Feedback (optional)</label>\r\n                        <textarea class=\"quiz-q${index}-feedback\" rows=\"2\">${escapeHtml(feedback)}</textarea>\r\n                    </div>\r\n                </div>\r\n            `;\r\n            $list.append(block);\r\n        });\r\n\r\n        $draft.removeClass('hidden');\r\n        applyQuizInlineStyles(); // re-apply to new elements\r\n    }\r\n\r\n    // --- UPLOAD QUIZ TO MOODLE ---\r\n\r\n    function handleUpload() {\r\n        updateGenerateState();\r\n\r\n        if (!draftQuestions.length) {\r\n            Notification.alert('Quiz generator', 'No questions to upload. Generate questions first.', 'OK');\r\n            return;\r\n        }\r\n        if (!selectedCourseId || !selectedSectionId || !quizConfig.quizname) {\r\n            Notification.alert('Quiz generator', 'Course, section or quiz name missing.', 'OK');\r\n            return;\r\n        }\r\n\r\n        // Collect edited questions from DOM\r\n        const cleaned = [];\r\n        $('#quiz-panel .quiz-draft-item').each(function() {\r\n            const $item = $(this);\r\n            const idx = parseInt($item.attr('data-qindex'), 10) || 0;\r\n\r\n            const questiontext = $item.find(`.quiz-q${idx}-text`).val().trim();\r\n            if (!questiontext) {\r\n                return; // skip blank\r\n            }\r\n\r\n            const options = [];\r\n            $item.find(`.quiz-q${idx}-opt`).each(function() {\r\n                const text = $(this).val().trim();\r\n                if (text) {\r\n                    options.push(text);\r\n                }\r\n            });\r\n            if (options.length < 2) {\r\n                return; // skip invalid\r\n            }\r\n\r\n            const correctStr = $item.find(`input[name=\"quiz-q${idx}-correct\"]:checked`).val();\r\n            const correctIndex = correctStr !== undefined ? parseInt(correctStr, 10) : 0;\r\n\r\n            const feedback = $item.find(`.quiz-q${idx}-feedback`).val().trim();\r\n\r\n            cleaned.push({\r\n                questiontext: questiontext,\r\n                options: options,\r\n                correct_index: isNaN(correctIndex) ? 0 : correctIndex,\r\n                feedback: feedback\r\n            });\r\n        });\r\n\r\n        if (!cleaned.length) {\r\n            Notification.alert('Quiz generator', 'No valid questions to upload.', 'OK');\r\n            return;\r\n        }\r\n\r\n        const payload = {\r\n            action: 'upload',\r\n            courseid: selectedCourseId,\r\n            sectionid: selectedSectionId,\r\n            quizname: quizConfig.quizname,\r\n            marksperquestion: quizConfig.marksperquestion,\r\n            timelimitminutes: quizConfig.timelimitminutes,\r\n            questions: draftQuestions,\r\n        };\r\n\r\n        const $btn = $('#quiz-panel .quiz-btn-upload').prop('disabled', true);\r\n        $btn.text('Uploading...');\r\n\r\n        $.ajax({\r\n            url: M.cfg.wwwroot + '/local/automation/quiz_ajax.php?sesskey=' + M.cfg.sesskey,\r\n            method: 'POST',\r\n            contentType: 'application/json',\r\n            dataType: 'json',\r\n            data: JSON.stringify(payload),\r\n            success: function(res) {\r\n                if (!res || !res.success) {\r\n                    Notification.alert('Quiz generator', (res && res.message) ? res.message : 'Failed to create quiz.', 'OK');\r\n                    return;\r\n                }\r\n\r\n                const msg = `\r\n<p>${escapeHtml(res.message || 'Quiz created successfully.')}</p>\r\n<p>\r\n  <a href=\"${escapeHtml(res.settingsurl || '#')}\" target=\"_blank\">Open quiz settings</a><br/>\r\n  <a href=\"${escapeHtml(res.editurl || '#')}\" target=\"_blank\">Open question editor</a>\r\n</p>`;\r\n                Notification.alert('Quiz created', msg, 'OK');\r\n            },\r\n            error: function(xhr) {\r\n                console.error('Quiz upload AJAX error:', xhr);\r\n                Notification.alert('Quiz generator', 'AJAX error while creating quiz.', 'OK');\r\n            },\r\n            complete: function() {\r\n                $btn.prop('disabled', false).text('Upload quiz to course');\r\n            }\r\n        });\r\n    }\r\n\r\n    // --- EXPORTS ---\r\n\r\n    return {\r\n        beforeSend: beforeSend,\r\n        handleResponse: handleResponse,\r\n        reset: reset,\r\n        onModeActivated: onModeActivated,\r\n        generate: generate\r\n    };\r\n});\r\n"],"names":["define","$","Notification","selectedCourseId","selectedSectionId","fileMetaById","selectedFileIds","currentSections","quizConfig","quizname","numquestions","marksperquestion","timelimitminutes","draftQuestions","escapeHtml","str","String","replace","ensurePanel","length","prepend","applyQuizInlineStyles","on","cid","this","val","parseInt","courseid","html","empty","append","prop","updateGenerateState","ajax","url","M","cfg","wwwroot","method","data","JSON","stringify","action","sesskey","contentType","dataType","success","res","console","error","sections","$select","forEach","sec","label","name","id","populateSectionSelect","section","sname","files","Array","isArray","treeRoot","root","type","children","file","fileid","path","sectionname","parts","split","filter","Boolean","node","i","folderName","filename","buildTreeFromFiles","renderTreeNode","renderFileTree","xhr","loadFilesForCourse","sid","checked","is","recomputeSelectedFiles","totalFiles","totalSelected","alert","cleaned","each","$item","idx","attr","questiontext","find","trim","options","text","push","correctStr","correctIndex","undefined","feedback","correct_index","isNaN","payload","sectionid","questions","$btn","message","msg","settingsurl","editurl","complete","handleUpload","courses","c","fullname","shortname","populateCourseSelect","$panel","css","border","borderRadius","padding","marginBottom","background","fontSize","display","fontWeight","width","maxWidth","boxSizing","gridTemplateColumns","gap","maxHeight","overflowY","marginTop","paddingTop","borderTop","marginLeft","color","courseVal","sectionVal","parseFloat","hasCourse","hasSection","hasFiles","hasQuizName","hasNumQuestions","enabled","keys","Object","key","child","fid","labelText","beforeSend","handleResponse","ui","reset","remove","onModeActivated","generate","instructions","appendMessage","fileids","$draft","$list","q","index","opts","correct","htmlOptions","map","opt","join","block","removeClass","renderDraftQuestions"],"mappings":"AACAA,oCAAO,CAAC,SAAU,sBAAsB,SAASC,EAAGC,kBAK5CC,iBAAmB,KACnBC,kBAAoB,KAEpBC,aAAe,GACfC,gBAAkB,GAClBC,gBAAkB,GAElBC,WAAa,CACbC,SAAU,GACVC,aAAc,GACdC,iBAAkB,EAClBC,iBAAkB,GAGlBC,eAAiB,YAkCZC,WAAWC,YACZA,MAAAA,IAA0C,GACvCC,OAAOD,KACTE,QAAQ,KAAM,SACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,UACdA,QAAQ,KAAM,mBAKdC,iBACDjB,EAAE,eAAekB,cAyErBlB,EAAE,qBAAqBmB,g7FAEvBC,wBA6WApB,EAAE,uBAAuBqB,GAAG,UAAU,iBAC5BC,IAAMtB,EAAEuB,MAAMC,MACpBtB,iBAAmBoB,IAAMG,SAASH,IAAK,IAAM,cAzNzBI,cACnBA,gBACD1B,EAAE,oBAAoB2B,KAAK,+DAC3B3B,EAAE,wBAAwB4B,QAAQC,OAAO,6CACzCzB,aAAe,GACfC,gBAAkB,GAClBC,gBAAkB,GAClBN,EAAE,2BAA2B8B,KAAK,WAAW,QAC7CC,sBAIJ/B,EAAEgC,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,gCACrBC,OAAQ,OACRC,KAAMC,KAAKC,UAAU,CACjBC,OAAQ,cACRf,SAAUA,SACVgB,QAASR,EAAEC,IAAIO,UAEnBC,YAAa,mBACbC,SAAU,OACVC,QAAS,SAASC,SACTA,MAAQA,IAAID,eACbE,QAAQC,MAAM,0BAA2BF,KACzC9C,EAAE,oBAAoB2B,KAAK,gEAC3BvB,aAAe,GACfC,gBAAkB,GAClBC,gBAAkB,GAClBN,EAAE,wBAAwB4B,QAAQC,OAAO,kDACzCE,sBAGJzB,gBAAkBwC,IAAIG,UAAY,YAgBfA,gBACrBC,QAAUlD,EAAE,wBAClBkD,QAAQtB,QACRsB,QAAQrB,OAAO,6CAEfoB,SAASE,SAAQC,YACPC,MAAQxC,WAAWuC,IAAIE,MAAS,WAAaF,IAAIG,IACvDL,QAAQrB,gCACcd,OAAOqC,IAAIG,iBAAQF,uBAvBrCG,CAAsBlD,0BA8BV2C,aACpB7C,aAAe,GACfC,gBAAkB,GAClBL,EAAE,2BAA2B8B,KAAK,WAAW,IAExCmB,SAAS/B,cACVlB,EAAE,oBAAoB2B,KAAK,6FAC3BI,0BAIAJ,KAAO,GAEXsB,SAASE,SAAQM,gBACPC,MAAQ7C,WAAW4C,QAAQH,MAAQ,SACnCK,MAAQC,MAAMC,QAAQJ,QAAQE,OAASF,QAAQE,MAAQ,OAExDA,MAAMzC,oBAIL4C,kBAuBcL,QAASE,aAC3BI,KAAO,CACTC,KAAM,OACNV,KAAMG,QAAQH,MAAQ,UACtBW,SAAU,WAGdN,MAAMR,SAAQe,aACJC,OAASD,KAAKC,OACdb,KAAOY,KAAKZ,KACZc,KAAOF,KAAKE,MAAQd,KAE1BlD,aAAa+D,QAAU,CACnBb,KAAMA,KACNc,KAAMA,KACNC,YAAaZ,QAAQH,MAAQ,GAC7B5B,SAAU+B,QAAQ/B,UAAYxB,wBAG5BoE,MAAQF,KAAKG,MAAM,KAAKC,OAAOC,aACjCC,KAAOX,SAEN,IAAIY,EAAI,EAAGA,EAAIL,MAAMpD,OAAS,EAAGyD,IAAK,OACjCC,WAAaN,MAAMK,GACpBD,KAAKT,SAASW,cACfF,KAAKT,SAASW,YAAc,CACxBZ,KAAM,SACNV,KAAMsB,WACNX,SAAU,KAGlBS,KAAOA,KAAKT,SAASW,kBAGnBC,SAAWP,MAAMA,MAAMpD,OAAS,IAAMoC,KAC5CoB,KAAKT,SAASY,UAAY,CACtBb,KAAM,OACNV,KAAMuB,SACNV,OAAQA,WAITJ,KAjEce,CAAmBrB,QAASE,OAE7ChC,yNAIc+B,4HAGAqB,eAAejB,mFAM5BnC,OACDA,KAAO,wFAGX3B,EAAE,oBAAoB2B,KAAKA,MAC3BI,sBAtEQiD,CAAe1E,kBAEnB0C,MAAO,SAASiC,KACZlC,QAAQC,MAAM,+BAAgCiC,KAC9CjF,EAAE,oBAAoB2B,KAAK,sDAC3BvB,aAAe,GACfC,gBAAkB,GAClBC,gBAAkB,GAClBN,EAAE,wBAAwB4B,QAAQC,OAAO,6CACzCE,yBA8KJmD,CAAmBhF,kBACnB6B,yBAIJ/B,EAAE,wBAAwBqB,GAAG,UAAU,iBAC7B8D,IAAMnF,EAAEuB,MAAMC,MACpBrB,kBAAoBgF,IAAM1D,SAAS0D,IAAK,IAAM,KAC9CpD,yBAIJ/B,EAAE,2BAA2BqB,GAAG,UAAU,iBAChC+D,QAAUpF,EAAEuB,MAAM8D,GAAG,YAC3BrF,EAAE,uBAAuB8B,KAAK,UAAWsD,SACzCE,yBACAvD,yBAIJ/B,EAAE,qBAAqBqB,GAAG,SAAU,uBAAuB,WACvDiE,+BACMC,WAAavF,EAAE,uBAAuBkB,OACtCsE,cAAgBxF,EAAE,+BAA+BkB,OACvDlB,EAAE,2BAA2B8B,KAAK,UAAWyD,WAAa,GAAKA,aAAeC,eAC9EzD,yBAIJ/B,EAAE,sEAAsEqB,GAAG,SAAS,WAChFU,yBAMJ/B,EAAE,eAAeqB,GAAG,QAAS,oBAAoB,0BA8JjDU,uBAEKnB,eAAeM,mBAChBjB,aAAawF,MAAM,iBAAkB,oDAAqD,UAGzFvF,mBAAqBC,oBAAsBI,WAAWC,qBACvDP,aAAawF,MAAM,iBAAkB,wCAAyC,YAK5EC,QAAU,MAChB1F,EAAE,gCAAgC2F,MAAK,iBAC7BC,MAAQ5F,EAAEuB,MACVsE,IAAMpE,SAASmE,MAAME,KAAK,eAAgB,KAAO,EAEjDC,aAAeH,MAAMI,sBAAeH,cAAYrE,MAAMyE,WACvDF,0BAICG,QAAU,MAChBN,MAAMI,sBAAeH,aAAWF,MAAK,iBAC3BQ,KAAOnG,EAAEuB,MAAMC,MAAMyE,OACvBE,MACAD,QAAQE,KAAKD,SAGjBD,QAAQhF,OAAS,eAIfmF,WAAaT,MAAMI,iCAA0BH,2BAAyBrE,MACtE8E,kBAA8BC,IAAfF,WAA2B5E,SAAS4E,WAAY,IAAM,EAErEG,SAAWZ,MAAMI,sBAAeH,kBAAgBrE,MAAMyE,OAE5DP,QAAQU,KAAK,CACTL,aAAcA,aACdG,QAASA,QACTO,cAAeC,MAAMJ,cAAgB,EAAIA,aACzCE,SAAUA,eAIbd,QAAQxE,mBACTjB,aAAawF,MAAM,iBAAkB,gCAAiC,YAIpEkB,QAAU,CACZlE,OAAQ,SACRf,SAAUxB,iBACV0G,UAAWzG,kBACXK,SAAUD,WAAWC,SACrBE,iBAAkBH,WAAWG,iBAC7BC,iBAAkBJ,WAAWI,iBAC7BkG,UAAWjG,gBAGTkG,KAAO9G,EAAE,gCAAgC8B,KAAK,YAAY,GAChEgF,KAAKX,KAAK,gBAEVnG,EAAEgC,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,2CAA6CF,EAAEC,IAAIO,QACxEL,OAAQ,OACRM,YAAa,mBACbC,SAAU,OACVN,KAAMC,KAAKC,UAAUmE,SACrB9D,QAAS,SAASC,SACTA,MAAQA,IAAID,oBACb5C,aAAawF,MAAM,iBAAmB3C,KAAOA,IAAIiE,QAAWjE,IAAIiE,QAAU,yBAA0B,YAIlGC,mBACjBnG,WAAWiC,IAAIiE,SAAW,+DAElBlG,WAAWiC,IAAImE,aAAe,0EAC9BpG,WAAWiC,IAAIoE,SAAW,yDAEvBjH,aAAawF,MAAM,eAAgBuB,IAAK,OAE5ChE,MAAO,SAASiC,KACZlC,QAAQC,MAAM,0BAA2BiC,KACzChF,aAAawF,MAAM,iBAAkB,kCAAmC,OAE5E0B,SAAU,WACNL,KAAKhF,KAAK,YAAY,GAAOqE,KAAK,4BAtPtCiB,MAnZJrF,sBAiHA/B,EAAEgC,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,gCACrBC,OAAQ,OACRC,KAAMC,KAAKC,UAAU,CACjBC,OAAQ,gBACRC,QAASR,EAAEC,IAAIO,UAEnBC,YAAa,mBACbC,SAAU,OACVC,QAAS,SAASC,KACTA,KAAQA,IAAID,iBAYCwE,eACpBnE,QAAUlD,EAAE,uBAClBkD,QAAQtB,QACRsB,QAAQrB,OAAO,4CAEfwF,QAAQlE,SAAQmE,UACNjE,MAAQxC,WAAWyG,EAAEC,UAAYD,EAAEE,WAAc,UAAYF,EAAE/D,IACrEL,QAAQrB,gCACcd,OAAOuG,EAAE/D,iBAAQF,uBAhBnCoE,CAAqB3E,IAAIuE,SAAW,IAHhCtE,QAAQC,MAAM,4BAA6BF,MAKnDE,MAAO,SAASiC,KACZlC,QAAQC,MAAM,iCAAkCiC,iBA9HnD7D,8BAECsG,OAAS1H,EAAE,eACjB0H,OAAOC,IAAI,CACPC,OAAQ,iBACRC,aAAc,MACdC,QAAS,WACTC,aAAc,OACdC,WAAY,UACZC,SAAU,YAGdP,OAAO1B,KAAK,aAAa2B,IAAI,CACzBI,aAAc,QAGlBL,OAAO1B,KAAK,SAAS2B,IAAI,CACrBO,QAAS,QACTC,WAAY,MACZJ,aAAc,QAGlBL,OAAO1B,KAAK,8DAA8D2B,IAAI,CAC1ES,MAAO,OACPC,SAAU,OACVC,UAAW,aACXR,QAAS,UACTG,SAAU,YAGdP,OAAO1B,KAAK,oBAAoB2B,IAAI,CAChCO,QAAS,OACTK,oBAAqB,4BACrBC,IAAK,QAGTd,OAAO1B,KAAK,oBAAoB2B,IAAI,CAChCc,UAAW,QACXC,UAAW,OACXZ,QAAS,UACTE,WAAY,OACZJ,OAAQ,oBACRC,aAAc,MACdI,SAAU,WAGdP,OAAO1B,KAAK,eAAe2B,IAAI,CAC3BgB,UAAW,OACXC,WAAY,MACZC,UAAW,mBAGfnB,OAAO1B,KAAK,oBAAoB2B,IAAI,CAChCC,OAAQ,iBACRC,aAAc,MACdC,QAAS,MACTC,aAAc,MACdC,WAAY,YAGhBN,OAAO1B,KAAK,gEAAgE2B,IAAI,CAC5ES,MAAO,OACPE,UAAW,aACXL,SAAU,WAGdP,OAAO1B,KAAK,yCAAyC2B,IAAI,CACrDS,MAAO,MACPU,WAAY,MACZb,SAAU,WAGdP,OAAO1B,KAAK,cAAc2B,IAAI,CAC1BM,SAAU,UACVc,MAAO,kBAMNhH,4BACCiH,UAAYhJ,EAAE,uBAAuBwB,MAC3CtB,iBAAmB8I,UAAYvH,SAASuH,UAAW,IAAM,WAEnDC,WAAajJ,EAAE,wBAAwBwB,MAC7CrB,kBAAoB8I,WAAaxH,SAASwH,WAAY,IAAM,KAE5D1I,WAAWC,SAAWR,EAAE,oBAAoBwB,MAAMyE,OAClD1F,WAAWE,aAAegB,SAASzB,EAAE,sBAAsBwB,OAAS,IAAK,IACzEjB,WAAWG,iBAAmBwI,WAAWlJ,EAAE,eAAewB,OAAS,KACnEjB,WAAWI,iBAAmBc,SAASzB,EAAE,mBAAmBwB,OAAS,IAAK,UAEpE2H,YAAcjJ,iBACdkJ,aAAejJ,kBACfkJ,SAAWhJ,gBAAgBa,OAAS,EACpCoI,YAAc/I,WAAWC,SAASU,OAAS,EAC3CqI,gBAAkBhJ,WAAWE,aAAe,EAE5C+I,QAAUL,WAAaC,YAAcC,UAAYC,aAAeC,gBAGtEvJ,EAAE,kBAAkB8B,KAAK,YAAa0H,SACtCxJ,EAAE,qBAAqB8B,KAAK,YAAa0H,kBAmMpCzE,eAAeL,UACfA,OAASA,KAAKT,eACR,SAGLwF,KAAOC,OAAOD,KAAK/E,KAAKT,cACzBwF,KAAKvI,aACC,OAGPS,KAAO,uCAEX8H,KAAKtG,SAAQwG,YACHC,MAAQlF,KAAKT,SAAS0F,QACT,WAAfC,MAAM5F,KACNrC,oNAIcd,WAAW+I,MAAMtG,+EAErByB,eAAe6E,kEAGtB,GAAmB,SAAfA,MAAM5F,KAAiB,OACxB6F,IAAMD,MAAMzF,OACZZ,GAAK,aAAesG,IACpBC,UAAYjJ,WAAWT,aAAayJ,KAAKzF,MAAQwF,MAAMtG,MAE7D3B,mGAEsB4B,0GAEAA,0HAESsG,6HAEjBC,kGAOtBnI,MAAQ,SACDA,cAGF2D,yBACLjF,gBAAkB,GAClBL,EAAE,+BAA+B2F,MAAK,iBAC5BxB,OAAS1C,SAASzB,EAAEuB,MAAMe,KAAK,UAAW,IAC3CoE,MAAMvC,SACP9D,gBAAgB+F,KAAKjC,iBA8S1B,CACH4F,oBAtvBgB5D,aAETA,MAqvBP6D,wBAlvBoBlH,IAAKmH,WAElB,GAivBPC,iBA1wBAhK,iBAAmB,KACnBC,kBAAoB,KACpBC,aAAe,GACfC,gBAAkB,GAClBC,gBAAkB,GAClBC,WAAa,CACTC,SAAU,GACVC,aAAc,GACdC,iBAAkB,EAClBC,iBAAkB,GAEtBC,eAAiB,GAEjBZ,EAAE,eAAemK,SACjBnK,EAAE,kBAAkB8B,KAAK,YAAY,GACrC9B,EAAE,qBAAqB8B,KAAK,YAAY,GAAOqE,KAAK,SA4vBpDiE,2BA1PAnJ,cACAjB,EAAE,qBAAqBmG,KAAK,QAG5BpE,uBAuPAsI,kBA9OcC,aAAcL,OAC5BlI,uBAEK7B,6BACD+J,GAAGM,cAAc,mCAAoC,WAGpDpK,8BACD8J,GAAGM,cAAc,6DAA8D,WAG9ElK,gBAAgBa,mBACjB+I,GAAGM,cAAc,wDAAyD,WAGzEhK,WAAWC,qBACZyJ,GAAGM,cAAc,+BAAgC,UAGjDhK,WAAWE,cAAgB,cAC3BwJ,GAAGM,cAAc,+CAAgD,OAKrEvK,EAAE,uBAAuB8B,KAAK,YAAY,GAC1C9B,EAAE,wBAAwB8B,KAAK,YAAY,GAC3C9B,EAAE,2BAA2B8B,KAAK,YAAY,GAC9C9B,EAAE,uBAAuB8B,KAAK,YAAY,GAC1C9B,EAAE,oBAAoB8B,KAAK,YAAY,GACvC9B,EAAE,sBAAsB8B,KAAK,YAAY,GACzC9B,EAAE,eAAe8B,KAAK,YAAY,GAClC9B,EAAE,mBAAmB8B,KAAK,YAAY,GACtC9B,EAAE,kBAAkB8B,KAAK,YAAY,GACrC9B,EAAE,qBAAqB8B,KAAK,YAAY,GACxC9B,EAAE,4BAA4B8B,KAAK,YAAY,GAE/CmI,GAAGM,cAAc,4CAA6C,aAExD5D,QAAU,CACZlE,OAAQ,WACRf,SAAUxB,iBACV0G,UAAWzG,kBACXqK,QAASnK,gBACTG,SAAUD,WAAWC,SACrBC,aAAcF,WAAWE,aACzBC,iBAAkBH,WAAWG,iBAC7BC,iBAAkBJ,WAAWI,iBAC7B2J,aAAcA,cAAgB,IAGlCtK,EAAEgC,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,2CAA6CF,EAAEC,IAAIO,QACxEL,OAAQ,OACRM,YAAa,mBACbC,SAAU,OACVN,KAAMC,KAAKC,UAAUmE,SACrB9D,QAAS,SAASC,KACTA,KAAQA,IAAID,SAKjBjC,eAAiBkC,IAAI+D,WAAa,oBAyBpC4D,OAASzK,EAAE,2BACX0K,MAAQD,OAAOzE,KAAK,oBAC1B0E,MAAM9I,QAENhB,eAAeuC,SAAQ,CAACwH,EAAGC,eACjBC,KAAOjH,MAAMC,QAAQ8G,EAAEzE,SAAWyE,EAAEzE,QAAU,GAC9C4E,QAAUrJ,SAASkJ,EAAElE,cAAe,KAAO,EAC3CD,SAAWmE,EAAEnE,UAAY,GAEzBuE,YAAcF,KAAKG,KAAI,CAACC,IAAKtG,sLAIFiG,kEACLjG,eAAMA,IAAMmG,QAAU,UAAY,kKAIhCF,+DACDjG,kDACL9D,WAAWoK,qDAEhCC,KAAK,IAEFC,4EAC0CP,oHAElBA,MAAQ,sEACDA,iCAAwB/J,WAAW8J,EAAE5E,cAAgB,sIAG5EgF,uNAIuBH,qCAA4B/J,WAAW2F,2FAI5EkE,MAAM7I,OAAOsJ,UAGjBV,OAAOW,YAAY,UACnBhK,wBAnEQiK,IALIpL,aAAawF,MAAM,iBAAmB3C,KAAOA,IAAIiE,QAAWjE,IAAIiE,QAAU,gCAAiC,OAOnH/D,MAAO,SAASiC,KACZlC,QAAQC,MAAM,4BAA6BiC,KAC3ChF,aAAawF,MAAM,iBAAkB,sCAAuC,OAEhF0B,SAAU,WAENnH,EAAE,uBAAuB8B,KAAK,YAAY,GAC1C9B,EAAE,wBAAwB8B,KAAK,YAAY,GAC3C9B,EAAE,2BAA2B8B,KAAK,YAAY,GAC9C9B,EAAE,uBAAuB8B,KAAK,YAAY,GAC1C9B,EAAE,oBAAoB8B,KAAK,YAAY,GACvC9B,EAAE,sBAAsB8B,KAAK,YAAY,GACzC9B,EAAE,eAAe8B,KAAK,YAAY,GAClC9B,EAAE,mBAAmB8B,KAAK,YAAY,GACtC9B,EAAE,kBAAkB8B,KAAK,YAAY,GACrC9B,EAAE,qBAAqB8B,KAAK,YAAY"}
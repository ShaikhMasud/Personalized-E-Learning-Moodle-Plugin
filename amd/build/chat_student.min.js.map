{"version":3,"file":"chat_student.min.js","sources":["../src/chat_student.js"],"sourcesContent":["define(['jquery'], function($) {\r\n    'use strict';\r\n\r\n    let config = null;\r\n\r\n    function initConfig(cfg) {\r\n        config = cfg;\r\n    }\r\n\r\n    function saveMessageToDB(message, sender) {\r\n        if (!config || !config.currentcourseid) {\r\n            console.error('Student config not initialized');\r\n            return;\r\n        }\r\n        return $.ajax({\r\n            url: M.cfg.wwwroot + '/local/automation/student_ajax.php',\r\n            method: 'POST',\r\n            data: {\r\n                action: 'save_message',\r\n                courseid: config.currentcourseid,\r\n                message: message,\r\n                sender: sender,\r\n                sesskey: M.cfg.sesskey\r\n            }\r\n        });\r\n    }\r\n\r\n    function loadHistory(appendMessage) {\r\n        if (!config || !config.currentcourseid) {\r\n            console.error('Student config not initialized');\r\n            return;\r\n        }\r\n        $.ajax({\r\n            url: M.cfg.wwwroot + '/local/automation/student_ajax.php',\r\n            method: 'POST',\r\n            data: {\r\n                action: 'fetch_history',\r\n                courseid: config.currentcourseid,\r\n                sesskey: M.cfg.sesskey\r\n            },\r\n            success: function(res) {\r\n                if (typeof res === 'string') {\r\n                    res = JSON.parse(res);\r\n                }\r\n                $('#chatbot-messages').empty();\r\n\r\n                res.forEach(msg => {\r\n                    appendMessage(msg.message, msg.sender, parseInt(msg.timecreated), false);\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    function insertDummyQuiz() {\r\n        if (!config || !config.currentcourseid) {\r\n            console.error('Student config not initialized');\r\n            return;\r\n        }\r\n        return $.ajax({\r\n            url: M.cfg.wwwroot + '/local/automation/student_ajax.php',\r\n            method: 'POST',\r\n            data: {\r\n                action: 'insert_dummy_quiz',\r\n                courseid: config.currentcourseid,\r\n                sesskey: M.cfg.sesskey\r\n            }\r\n        });\r\n    }\r\n\r\n    function askRAG(message) {\r\n        return $.ajax({\r\n            url: M.cfg.wwwroot + '/local/automation/student_ajax.php',\r\n            method: 'POST',\r\n            data: {\r\n                action: 'ask_rag',\r\n                courseid: config.currentcourseid,\r\n                question: message,\r\n                sesskey: M.cfg.sesskey\r\n            }\r\n        });\r\n    }\r\n\r\n    return {\r\n        initConfig: initConfig,\r\n        saveMessageToDB: saveMessageToDB,\r\n        loadHistory: loadHistory,\r\n        insertDummyQuiz: insertDummyQuiz,\r\n        askRAG: askRAG\r\n    };\r\n});"],"names":["define","$","config","initConfig","cfg","saveMessageToDB","message","sender","currentcourseid","ajax","url","M","wwwroot","method","data","action","courseid","sesskey","console","error","loadHistory","appendMessage","success","res","JSON","parse","empty","forEach","msg","parseInt","timecreated","insertDummyQuiz","askRAG","question"],"mappings":"AAAAA,uCAAO,CAAC,WAAW,SAASC,OAGpBC,OAAS,WA+EN,CACHC,oBA9EgBC,KAChBF,OAASE,KA8ETC,yBA3EqBC,QAASC,WACzBL,QAAWA,OAAOM,uBAIhBP,EAAEQ,KAAK,CACVC,IAAKC,EAAEP,IAAIQ,QAAU,qCACrBC,OAAQ,OACRC,KAAM,CACFC,OAAQ,eACRC,SAAUd,OAAOM,gBACjBF,QAASA,QACTC,OAAQA,OACRU,QAASN,EAAEP,IAAIa,WAXnBC,QAAQC,MAAM,mCA0ElBC,qBA1DiBC,eACZnB,QAAWA,OAAOM,gBAIvBP,EAAEQ,KAAK,CACHC,IAAKC,EAAEP,IAAIQ,QAAU,qCACrBC,OAAQ,OACRC,KAAM,CACFC,OAAQ,gBACRC,SAAUd,OAAOM,gBACjBS,QAASN,EAAEP,IAAIa,SAEnBK,QAAS,SAASC,KACK,iBAARA,MACPA,IAAMC,KAAKC,MAAMF,MAErBtB,EAAE,qBAAqByB,QAEvBH,IAAII,SAAQC,MACRP,cAAcO,IAAItB,QAASsB,IAAIrB,OAAQsB,SAASD,IAAIE,cAAc,SAlB1EZ,QAAQC,MAAM,mCAyDlBY,8BAhCK7B,QAAWA,OAAOM,uBAIhBP,EAAEQ,KAAK,CACVC,IAAKC,EAAEP,IAAIQ,QAAU,qCACrBC,OAAQ,OACRC,KAAM,CACFC,OAAQ,oBACRC,SAAUd,OAAOM,gBACjBS,QAASN,EAAEP,IAAIa,WATnBC,QAAQC,MAAM,mCAgClBa,gBAlBY1B,gBACLL,EAAEQ,KAAK,CACVC,IAAKC,EAAEP,IAAIQ,QAAU,qCACrBC,OAAQ,OACRC,KAAM,CACFC,OAAQ,UACRC,SAAUd,OAAOM,gBACjByB,SAAU3B,QACVW,QAASN,EAAEP,IAAIa"}